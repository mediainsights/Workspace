#!/bin/bash 

############################################################################# 
# Source files
#############################################################################

source ~/.bash_profile
source includes/config
source includes/functions

############################################################################# 
# Push Workspace to in repository
#############################################################################

if [ $1 = pushws ]; then
	
	#Usage check
	: ${2?"Usage: $0 $1 version number"}
	
	pushws $2
	
	exit
fi

############################################################################# 
# Check usage and platform settings
#############################################################################

#Usage check
: ${1?"Usage: $0 SITE"}

#Check vhost exist
if [ -f $APACHEDIR/other/$1.$SERVER.conf ]; then
  echo vhost $1.$SERVER is already existed
  exit
fi

#Check project directory exist
if [ -d $WWW/$1 ]; then
  echo Folder $1 is already existed
  exit
fi

#Check drush settings
if [ ! -d /Users/$USER/.drush ]; then
	echo ".drush folder not found"
	exit
fi

#Check db exist
if [ check_db_exist $1_db ]; then	
	echo database $1_db alread exist
	exit
fi

############################################################################# 
# Find out the repository to download
############################################################################# 


if [ $2 = dev ]; then
	repo_index=1
else
	repo_index=0
fi

#Load preset value
branch=$PRESET_BRANCH
repo=${REPOS[$repo_index]}

printf "%s = %s\n" 'Repo' $repo
printf "%s = %s\n" 'Branch' $branch

#####

############################################################################# 
# Copy ip from ipcache
#############################################################################

#if ipcache not exist, clone from github
if [ ! -d $WWW/ipcache ]; then
	echo Clone $branch branch
	git clone --branch $branch $repo $WWW/ipcache	
	
else

	if [ $1=dev ]; then
		cd $WWW/ipcache
		echo git remote add kw $repo
		git pull kw
	fi

fi


